Step 18.1 — Define Admin Roles & Access Checks
Description:
- Document admin role flags and ensure backend auth helper exposes `isAdmin`. Add constants for admin-only routes.
Expected Output:
- Role definitions in code; auth helper updated to include admin flag.
Testing Instructions:
- `npm run lint`; verify admin flag present in auth context via temporary log (remove after).
Dependencies:
- Step 7.3 auth, Master Doc admin role.

Step 18.2 — Admin Dashboard Stats Endpoint
Description:
- Implement `/api/admin/companies` (or similar) returning company list with key metrics (counts of transactions, last activity).
Expected Output:
- Endpoint returns admin-only metrics; 403 for non-admin.
Testing Instructions:
- `curl` with/without admin header; verify data vs DB counts.
Dependencies:
- Step 7.10 placeholder, Step 8 schema populated.

Step 18.3 — Admin Review Items Endpoint
Description:
- Provide `/api/admin/review-items` returning low-confidence transactions/documents flagged in Steps 12/10/13 with pagination and filters.
Expected Output:
- JSON with transactions and documents needing review; includes confidence and suggested values.
Testing Instructions:
- `curl` endpoint; verify flagged items show; ensure 403 for non-admin.
Dependencies:
- Steps 12.6, 13.5, 10.6 flags; Step 7.10.

Step 18.4 — Admin Logs Endpoint
Description:
- Add `/api/admin/logs` to fetch system_logs with filters (date, level, source).
Expected Output:
- Filterable log list; admin-only.
Testing Instructions:
- `curl` with filter params; verify results and 403 without admin.
Dependencies:
- Step 8.11 system_logs, Step 7.10 admin scaffold.

Step 18.5 — Admin Review Actions API
Description:
- Implement endpoints to update flagged items (set category/vat_code, reconcile selection) and re-run affected calculations.
Expected Output:
- PATCH endpoints for transactions/documents; return updated item; triggers recalc where needed.
Testing Instructions:
- Call PATCH with sample payload; verify DB update and status change; ensure only admin allowed.
Dependencies:
- Steps 12.4/13.4/10.5 pipelines, Step 7.3 auth.

Step 18.6 — Admin UI: Companies Overview
Description:
- Wire admin companies page to stats endpoint; render table/cards with counts and last activity; add loading/error states.
Expected Output:
- UI shows live company metrics; admin-only visibility.
Testing Instructions:
- Visit admin companies page as admin; verify data and network call; ensure non-admin blocked/redirected.
Dependencies:
- Step 18.2 backend, Step 4.8 UI, Step 5 hooks.

Step 18.7 — Admin UI: Review Queue
Description:
- Connect review queue UI to `/api/admin/review-items`; display confidence, suggested category/VAT, and actions; allow apply/override via Admin Review Actions API.
Expected Output:
- Review UI shows real flagged items; actions update status and remove from queue on success.
Testing Instructions:
- Load review page; perform an override; confirm UI updates and backend changes reflected.
Dependencies:
- Steps 18.3, 18.5 backend; Step 4.9 UI.

Step 18.8 — Admin UI: Logs Viewer
Description:
- Hook logs UI to `/api/admin/logs`; add filters and pagination; display levels and sources.
Expected Output:
- Logs render with filter controls; admin-only.
Testing Instructions:
- Filter logs by source/level; verify network requests and results; ensure non-admin blocked.
Dependencies:
- Step 18.4 backend; Step 4.9 UI base (or new component).

Step 18.9 — Admin Access Control & Navigation
Description:
- Ensure ProtectedRoute/admin checks guard all admin routes; sidebar shows admin section only for admins.
Expected Output:
- Non-admin users cannot see admin links or access admin pages; admins can.
Testing Instructions:
- Toggle admin flag in auth context; verify sidebar visibility and route protection.
Dependencies:
- Step 3.10 nav separation, Step 7.3 auth.

Step 18.10 — Update Build Log & Cleanup
Description:
- Document Step 18 in `buildlog.md`; remove temporary logs/mocks.
Expected Output:
- Build log updated; clean code.
Testing Instructions:
- `npm run lint`/`npm run build`; ensure buildlog entry present.
Dependencies:
- Steps 18.1–18.9.
